import React from 'react';
import PropTypes from 'prop-types';
import {
  Menu, Dropdown,
} from 'antd';
import intl from 'react-intl-universal';
import style from './styles/term.module.scss';


export const INSTRUCTION_TYPE_OPERATOR = 'operator';
export const OPERATOR_TYPE_AND = 'and';
export const OPERATOR_TYPE_OR = 'or';
export const OPERATOR_TYPE_AND_NOT = 'and not';
export const OPERATOR_TYPE_UNION = 'union';
export const OPERATOR_TYPE_INTERSECTION = 'intersection';
export const OPERATOR_TYPE_NOT_EQUAL = 'not equal';
export const OPERATOR_TYPE_EQUAL = 'equal';
export const OPERATOR_TYPE_DEFAULT = OPERATOR_TYPE_AND;
export const OPERATOR_TYPES = [
  OPERATOR_TYPE_AND,
  OPERATOR_TYPE_OR,
  OPERATOR_TYPE_AND_NOT,
  OPERATOR_TYPE_UNION,
  OPERATOR_TYPE_INTERSECTION,
  OPERATOR_TYPE_NOT_EQUAL,
  OPERATOR_TYPE_EQUAL,
];

const svgPathAnd = (<path id="and" d="M7.82479753,18.9949289 C5.47047361,18.8077295 3.45024683,17.671674 2.18108759,15.8212414 C1.38577602,14.6616768 1,13.4130053 1,11.998319 C1,10.5836328 1.38577602,9.33496125 2.18108759,8.17539668 C3.10970457,6.821474 4.44967311,5.84054939 6.06643375,5.33112728 C6.79857581,5.10043814 7.47705463,5.00149948 8.32687524,5.00149948 C9.56241251,5.00149948 10.602363,5.23914799 11.6907961,5.77022097 L11.9992153,5.92070684 L12.3076346,5.77022097 C13.0747798,5.39591213 13.8198933,5.17229731 14.7104352,5.04911927 C15.1839278,4.98362691 16.1591832,4.98362691 16.6326758,5.04911927 C18.3167614,5.2820583 19.7575625,5.97229909 20.9101372,7.09831075 C22.0368154,8.19902291 22.7113995,9.51686169 22.9485637,11.0804945 C23.0171454,11.5326576 23.0171454,12.4639805 22.9485637,12.9161436 C22.6330952,14.9960408 21.4820046,16.7369116 19.6748132,17.8672564 C18.4605497,18.6267415 17.1529756,18.9951386 15.6715555,18.9951386 C14.4360182,18.9951386 13.3960677,18.7574901 12.3076346,18.2264163 L11.9992153,18.0759313 L11.6907961,18.2264163 C10.6628338,18.7279844 9.64142171,18.9731934 8.4846713,18.9961055 C8.20063872,19.0017283 7.90369556,19.0012002 7.82479753,18.994925 L7.82479753,18.9949289 Z M8.52748584,17.860724 C9.14412955,17.8183705 9.61677561,17.7286362 10.172708,17.5483717 C10.4245837,17.4666987 10.9758872,17.2350845 10.9758872,17.210938 C10.9758872,17.2051378 10.8622192,17.1180764 10.7232915,17.0174671 C10.3945712,16.7794139 9.88408426,16.3052888 9.6205964,15.9933181 C8.83862864,15.0674634 8.36985911,14.0318974 8.18700916,12.8263574 C8.1250748,12.4180258 8.1250748,11.576983 8.18700916,11.1686514 C8.36982973,9.96330529 8.83792189,8.92908875 9.62040648,8.00165902 C9.89028379,7.68179031 10.4323318,7.18274088 10.7490657,6.96253219 C10.886076,6.86727556 10.99899,6.78262046 11,6.77440912 C11.0032399,6.74757497 10.4511461,6.51238886 10.172708,6.42199816 C8.84018085,5.98941368 7.47771714,5.98904898 6.13090293,6.42091808 C5.7652449,6.53816959 5.09167328,6.85624341 4.75772567,7.0693594 C3.4628789,7.89569461 2.55974327,9.10640306 2.17969705,10.5253645 C2.03398715,11.0693969 2,11.3454917 2,11.9851353 C2,12.624779 2.03398715,12.9008739 2.17969705,13.4449062 C2.4532996,14.4664442 3.01680901,15.4097578 3.7982792,16.1544085 C4.28537573,16.6185556 4.80139259,16.9677565 5.4443143,17.2683206 C6.28392553,17.6608365 7.04606997,17.8379113 8.08703287,17.8823226 C8.12978249,17.8841461 8.3279864,17.8744282 8.52748584,17.8607254 L8.52748584,17.860724 Z M20.2052598,16.1081738 C21.1347824,15.2250786 21.7423367,14.0783692 21.9509089,12.8134018 C22.0163637,12.4164252 22.0163637,11.5139529 21.9509089,11.1169763 C21.6746288,9.44136819 20.7213806,8.0172345 19.2490202,7.08040811 C18.9161886,6.86863565 18.244869,6.55256805 17.8804331,6.43605584 C16.538268,6.00695786 15.1833322,6.00723593 13.8521391,6.43687821 C13.6039678,6.51697621 13,6.77215997 13,6.79691814 C13,6.80268169 13.113288,6.88919278 13.2517513,6.98916771 C13.5793727,7.22572022 14.0881532,7.69685539 14.3507602,8.00685949 C14.9958334,8.76836001 15.4563189,9.66707655 15.6698518,10.5812945 C15.7894027,11.0931385 15.8244379,11.4095671 15.8244379,11.9774785 C15.8244379,13.2469734 15.4772229,14.3674919 14.7614074,15.4080486 C14.3658906,15.9829975 13.8204442,16.5491432 13.2840464,16.9414744 C13.1491243,17.0401593 13.0354823,17.1290685 13.0315082,17.1390519 C13.0203839,17.1669978 13.548754,17.3950476 13.8521391,17.4932439 C14.7521359,17.7845457 15.6141317,17.8748188 16.5634909,17.7771932 C17.9131563,17.6384052 19.2296452,17.0350585 20.2052598,16.1081738 Z" />);
const svgPathOr = (<path id="or" d="M8.58256714,18.9740809 C9.29888234,18.9237684 9.84792512,18.8171715 10.4937164,18.6030306 C10.7863048,18.5060101 11.4267191,18.2308699 11.4267191,18.2021862 C11.4267191,18.1952961 11.2946782,18.0918733 11.1332943,17.9723581 C10.7514412,17.6895686 10.1584413,17.1263457 9.85236401,16.7557479 C8.94400122,15.6559051 8.39946216,14.4257329 8.18705612,12.9936452 C8.11511176,12.5085786 8.11511176,11.5094853 8.18705612,11.0244195 C8.39942718,9.59256173 8.9431805,8.36399337 9.85214304,7.26227851 C10.1656427,6.88229952 10.7953054,6.28946752 11.163235,6.02787648 C11.3223911,5.91471984 11.4535562,5.81415533 11.4547294,5.80440172 C11.458493,5.77252401 10.8171611,5.4931412 10.4937164,5.38576407 C8.94580476,4.87188736 7.36311743,4.87145412 5.79860793,5.38448103 C5.37384619,5.5237667 4.59140161,5.90161367 4.203475,6.15477914 C2.69933363,7.13640061 1.65021825,8.57462856 1.20874351,10.2602441 C1.03948072,10.9065123 1,11.2344915 1,11.9943386 C1,12.7541849 1.03948072,13.082165 1.20874351,13.7284331 C1.52656939,14.9419408 2.18116339,16.0625238 3.08894689,16.9471108 C3.65477689,17.4984814 4.25420095,17.913305 5.00104147,18.2703519 C5.97636543,18.7366302 6.86169943,18.9469811 8.07092086,18.9997387 C8.12058038,19.0019049 8.35082129,18.9903602 8.58256714,18.9740829 L8.58256714,18.9740809 Z M16.6635709,18.9423582 C18.2366502,18.7764388 19.7710609,18.0551617 20.9081716,16.9471083 C21.991561,15.8914037 22.6996852,14.5205587 22.9427829,13.008341 C23.0190724,12.5337712 23.0190724,11.4549019 22.9427829,10.980332 C22.620769,8.97720988 21.5097277,7.27471483 19.7936435,6.15477664 C19.4057169,5.90161117 18.6232723,5.52376503 18.1985106,5.38447936 C16.6341726,4.87151078 15.0549507,4.87184237 13.5034017,5.38546247 C13.2141499,5.48121642 12.5102057,5.78627836 12.5102057,5.81587577 C12.5102057,5.82276586 12.6422466,5.92618639 12.8036301,6.04570157 C13.1854836,6.3284911 13.7784839,6.89171487 14.084561,7.26231184 C14.8364149,8.17265543 15.3731255,9.24703487 15.6220049,10.3399459 C15.7613456,10.9518344 15.8021802,11.3301121 15.8021802,12.0090278 C15.8021802,13.5266576 15.3974903,14.8661931 14.5631837,16.1101362 C14.1021959,16.797465 13.4664602,17.4742695 12.841271,17.9432856 C12.684015,18.0612595 12.5515615,18.1675471 12.5469295,18.1794815 C12.5339638,18.2128896 13.1497965,18.4855142 13.5034017,18.6029042 C14.5523774,18.9511437 15.5570614,19.0590617 16.6635709,18.9423537 L16.6635709,18.9423582 Z M14.8098747,13.4819947 C14.9640405,12.9334993 15,12.6551395 15,12.0102483 C15,11.3653578 14.9640405,11.0869979 14.8098747,10.5385026 C14.420146,9.15191834 13.47638,7.92115239 12.1850348,7.11544792 L12,7 L11.8149652,7.11544792 C10.5236199,7.92115239 9.5798542,9.15191834 9.19012525,10.5385026 C9.0359595,11.0869979 9,11.3653578 9,12.0102483 C9,12.6551395 9.0359595,12.9334993 9.19012525,13.4819947 C9.51537933,14.6391885 10.2421494,15.7165445 11.207507,16.4725379 C11.5900887,16.7721467 11.9708875,17.0176222 12.0241995,16.9990064 C12.0471342,16.9909978 12.1638742,16.9204181 12.2836213,16.8421629 C13.5356983,16.0239258 14.4295981,14.8349501 14.8098747,13.4819947 Z" />);
const svgPathAndNot = (<path id="and-not" d="M7.82479752,18.9949258 C5.47047361,18.8077264 3.45024682,17.6716713 2.18108759,15.8212386 C1.38577602,14.6616744 1,13.4130032 1,11.9983173 C1,10.5836313 1.38577602,9.33496008 2.18108759,8.17539583 C3.10970457,6.82147345 4.44967311,5.84054881 6.06643374,5.33112728 C6.79857581,5.10043797 7.47705462,5.00149901 8.32687523,5.00149901 C9.56241249,5.00149901 10.6023629,5.23914809 11.6907961,5.77022102 L11.9992152,5.92070608 L12.3076344,5.77022102 C13.0747802,5.39591227 13.819893,5.17229711 14.7104354,5.04911926 C15.1839279,4.98362691 16.1591832,4.98362691 16.6326758,5.04911926 C18.3167614,5.28205847 19.7575625,5.97229855 20.9101371,7.09831014 C22.0368154,8.19902204 22.7113993,9.51686048 22.9485636,11.080493 C23.0171455,11.532656 23.0171455,12.4639786 22.9485636,12.9161416 C22.6330949,14.9960385 21.4820045,16.736909 19.6748132,17.8672528 C18.4605496,18.6267385 17.1529756,18.9951355 15.6715555,18.9951355 C14.436018,18.9951355 13.3960676,18.7574863 12.3076344,18.2264134 L11.9992152,18.0759284 L11.6907961,18.2264134 C10.662834,18.7279814 9.64142194,18.9731903 8.48467129,18.9961024 C8.20063871,19.001733 7.90369555,19.0011971 7.82479752,18.9949219 L7.82479752,18.9949258 Z M20.1997507,16.1526935 C21.1321339,15.2642396 21.7415579,14.1105725 21.9507719,12.8379298 C22.0164283,12.4385444 22.0164283,11.5305964 21.9507719,11.131211 C21.6736416,9.44543596 20.7174598,8.01266115 19.2405684,7.07015044 C18.9067125,6.85709308 18.2333269,6.53910741 17.8677695,6.42188818 C16.5213263,5.99013982 15.1592384,5.99050442 13.8270785,6.42296936 C13.5487172,6.51333512 12.9967759,6.74845615 13,6.77528332 C13.001027,6.78349211 13.113907,6.86812418 13.2508798,6.96335411 C13.5675266,7.18350226 14.1094251,7.68241403 14.3792275,8.00219451 C15.0267967,8.76971678 15.4880584,9.6727728 15.7021889,10.5922822 C15.8221078,11.1072319 15.8572507,11.4255804 15.8572507,11.9969376 C15.8572507,12.5682949 15.8221078,12.8866434 15.7021889,13.4015931 C15.4879988,14.3213582 15.0260962,15.2255277 14.3790381,15.9916489 C14.1156227,16.3035336 13.6052761,16.7775279 13.2766467,17.0155162 C13.1377576,17.1160977 13.0241207,17.2031358 13.0241207,17.2089336 C13.0241207,17.2330736 13.5752719,17.4646238 13.8270785,17.5462743 C14.7309329,17.8393555 15.594648,17.9300459 16.5467744,17.8318434 C17.9005934,17.6922098 19.2211337,17.0852015 20.1997507,16.1526935 Z M12.2363508,16.2079252 C13.2797482,15.4923613 14.024665,14.4525801 14.341562,13.2693946 C14.4700338,12.789725 14.5,12.546294 14.5,11.9823246 C14.5,11.4183552 14.4700338,11.1749242 14.341562,10.6952546 C14.0167883,9.48266027 13.2303163,8.40633248 12.1541954,7.70172838 L12,7.60076691 L11.8458041,7.70172838 C10.7696832,8.40633248 9.9832118,9.48266027 9.6584377,10.6952546 C9.52996625,11.1749242 9.5,11.4183552 9.5,11.9823246 C9.5,12.546294 9.52996625,12.789725 9.6584377,13.2693946 C9.92948275,14.2813823 10.5351244,15.2235506 11.339589,15.8846811 C11.658407,16.1466947 11.9757396,16.3613683 12.0201661,16.3450879 C12.0392782,16.3380842 12.1365615,16.2763609 12.2363508,16.2079252 Z" />);
const svgPathUnion = (<path id="union-a" d="M9.04996157,15.7500378 C8.34998719,15.0675628 8,14.1842168 8,13.1 L8,4 L5,4 L5,13.1 C5,15.2843345 5.57858424,16.9550859 6.73575271,18.1122544 C7.89292119,19.2694229 9.64767029,19.8986714 12,20 L12.3664544,19.9796136 C14.5353848,19.8309723 16.1679824,19.2085193 17.2642473,18.1122544 C18.3605122,17.0159895 18.9374937,15.4587804 18.9951918,13.4406269 L19,13.1 L19,4 L16,4 L16,13.1 C16,14.1842168 15.6500128,15.0675628 14.9500384,15.7500378 C14.3039082,16.3800147 13.4163252,16.7834934 12.2872892,16.9604736 L12,17 C10.7332821,16.8491669 9.74993595,16.4325128 9.04996157,15.7500378 Z" />);
const svgPathIntersection = (<path id="intersection-a" d="M9.04996157,8.24996219 C8.34998719,8.93243721 8,9.81578315 8,10.9 L8,20 L5,20 L5,10.9 C5,8.71566554 5.57858424,7.04491407 6.73575271,5.88774559 C7.89292119,4.73057712 9.64767029,4.10132859 12,4 L12.3664544,4.0203864 C14.5353848,4.16902765 16.1679824,4.79148072 17.2642473,5.88774559 C18.3605122,6.98401047 18.9374937,8.54121963 18.9951918,10.5593731 L19,10.9 L19,20 L16,20 L16,10.9 C16,9.81578315 15.6500128,8.93243721 14.9500384,8.24996219 C14.3039082,7.61998525 13.4163252,7.21650664 12.2872892,7.03952636 L12,7 C10.7332821,7.15083311 9.74993595,7.56748717 9.04996157,8.24996219 Z" />);
const svgPathNotEqual = (<polygon id="exclusion-a" points="15.447 3 14.106 8 20 8 20 11 13.302 11 12.766 13 20 13 20 16 11.962 16 10.623 21 8.553 21 9.892 16 4 16 4 13 10.696 13 11.231 11 4 11 4 8 12.035 8 13.376 3" />);
const svgPathEqual = (<path id="equal-a" d="M20,13 L20,16 L4,16 L4,13 L20,13 Z M20,8 L20,11 L4,11 L4,8 L20,8 Z" />);

export const getSvgPathFromOperatorType = (type) => {
  switch (type) {
    default:
    case OPERATOR_TYPE_AND:
      return svgPathAnd;
    case OPERATOR_TYPE_OR:
      return svgPathOr;
    case OPERATOR_TYPE_AND_NOT:
      return svgPathAndNot;
    case OPERATOR_TYPE_UNION:
      return svgPathUnion;
    case OPERATOR_TYPE_INTERSECTION:
      return svgPathIntersection;
    case OPERATOR_TYPE_NOT_EQUAL:
      return svgPathNotEqual;
    case OPERATOR_TYPE_EQUAL:
      return svgPathEqual;
  }
};

class Operator extends React.Component {
  /* @NOTE SQON Struct Sample
  {
      type: 'and',
  }
  */
  static structFromArgs(type = OPERATOR_TYPE_DEFAULT) {
    return {
      type: (OPERATOR_TYPES.indexOf(type) !== -1 ? type : OPERATOR_TYPE_DEFAULT),
    };
  }

  constructor(props) {
    super(props);
    this.state = {
      data: null,
      options: {
        editable: null,
      },
      visible: null,
    };
    this.isEditable = this.isEditable.bind(this);
    this.isVisible = this.isVisible.bind(this);
    this.serialize = this.serialize.bind(this);
    this.createMenuComponent = this.createMenuComponent.bind(this);
    this.handleApply = this.handleApply.bind(this);

    // @NOTE Initialize Component State
    const { options, data, visible } = props;
    this.state.data = { ...data };
    this.state.options = {
      editable: options.editable || true,
    };
    this.state.visible = visible;
  }

  isEditable() {
    const { options } = this.state;
    const { editable } = options;
    return editable === true;
  }

  isVisible() {
    const { visible } = this.state;
    return visible === true;
  }

  serialize() {
    return Object.assign({}, this.props, this.state);
  }

  handleApply({ key }) {
    const { data } = this.state;
    if (this.isEditable() && data.type !== key) {
      const { onEditCallback } = this.props;
      data.type = key;
      this.setState({
        data,
      }, () => { onEditCallback(this.serialize()); });
    }
  }

  createMenuComponent() {
    return (
      <Menu onClick={this.handleApply} className={style.operatorMenu}>
        <Menu.Item key={OPERATOR_TYPE_AND}>
          <svg className={style.icon}>{svgPathAnd}</svg>
          { intl.get('components.query.instruction.operator.and') }
        </Menu.Item>
        <Menu.Item key={OPERATOR_TYPE_OR}>
          <svg className={style.icon}>{svgPathOr}</svg>
          { intl.get('components.query.instruction.operator.or') }
        </Menu.Item>
      </Menu>
    );
  }

  render() {
    const { data } = this.state;
    const { type } = data;
    return (
      <span>
        <Dropdown overlay={this.createMenuComponent}>
          <svg className={style.icon}>{ getSvgPathFromOperatorType(type) }</svg>
        </Dropdown>
      </span>
    );
  }
}

Operator.propTypes = {
  data: PropTypes.shape({}).isRequired,
  options: PropTypes.shape({}),
  onEditCallback: PropTypes.func,
  visible: PropTypes.bool,
};

Operator.defaultProps = {
  options: {
    editable: false,
  },
  onEditCallback: () => {},
  visible: true,
};

export default Operator;

export const createOperatorInstruction = type => ({
  type: INSTRUCTION_TYPE_OPERATOR,
  data: Operator.structFromArgs(type),
});
